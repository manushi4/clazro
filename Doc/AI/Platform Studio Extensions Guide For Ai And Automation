# Platform Studio Extensions Guide (AI Config UI, Validation, Publish Flow)

## 1. Purpose

This guide defines how Platform Studio must be extended to configure, validate, publish, and roll back:

* AI features and widgets
* audience profiles and child safety rules
* prompt templates and policies
* model routing and fallback rules
* tools/connectors/MCP allowlists
* automation workflows (triggers/actions/approvals)

It ensures AI and automation remain **config-driven**, **safe**, and **tenant-governed**, consistent with the platform’s architecture.

---

## 2. Design Principles

1. **Everything is versioned** (draft → validate → publish)
2. **Guardrails prevent app-breaking config**
3. **Child safety rules cannot be weakened**
4. **Validation is blocking, not advisory**
5. **Rollback is one-click**
6. **Audit logs for all changes**

---

## 3. New Studio Modules (Required)

### 3.1 AI Features Catalog

UI to manage:

* featureId
* enabled roles
* enabled audience profiles
* widgets/screens mapping
* capability class
* output mode (text/json/schema)

### 3.2 Audience Profiles

UI to manage:

* Kid/Teen/Adult/Coaching profiles
* tone rules, response limits
* topic restrictions
* tool policy references

### 3.3 Prompt Templates & Policies

UI to manage:

* system policies (global)
* profile policies
* feature templates
* variable definitions
* version history

### 3.4 Model Routing & Fallback

UI to manage:

* provider enablement per tenant
* routing rules per feature/profile
* fallback chains
* cost & latency constraints

### 3.5 Tools/Connectors/MCP

UI to manage:

* connectors list
* OAuth connections
* tool allowlists
* tool risk levels
* approvals required
* tool kill switch

### 3.6 Automation Workflows

UI to manage:

* triggers (event/schedule/condition)
* steps and actions
* guards (RBAC/consent/profile)
* approval rules
* retry/idempotency policy

---

## 4. Validation Framework

### 4.1 Config Schema Validation

* JSON schema validation for every module
* required fields and type checks

### 4.2 Cross-Module Validation

Must validate:

* feature references exist
* prompt template references exist
* routing rules reference enabled providers
* tool allowlists only reference supported tools
* kid profile never has tool access

### 4.3 Safety Validation (Blocking)

* kid/teen topic restrictions enforced
* forbidden template patterns blocked
* crisis flow enabled where required

### 4.4 Budget Validation

* tenant budgets exist
* feature caps not missing

### 4.5 Workflow Validation

* idempotency required for writes
* approvals required for high-risk actions
* retry policies defined

---

## 5. Publish Flow (Draft → Validate → Publish)

### 5.1 Draft Mode

* editable config
* not applied in runtime

### 5.2 Validate

* run validation framework
* show errors + warnings
* block publish if errors

### 5.3 Publish

* create immutable version
* update tenant’s active version pointer
* generate audit event

### 5.4 Rollback

* select previous known-good version
* update pointer instantly
* log rollback reason

---

## 6. Tenant Controls

Studio must support per-tenant:

* enable/disable AI globally
* enable/disable per feature
* enable/disable tools/connectors
* budgets and rate limits
* approval requirements

Tenants cannot override child safety constraints.

---

## 7. Operational Views

### 7.1 Audit Logs

* change history
* who modified what
* which version published

### 7.2 Observability Dashboards

* cost spend
* error rates
* refusal/safety flags
* automation success

### 7.3 Approval Queue

* pending approvals
* filters by feature/workflow

---

## 8. UX Guardrails (Must-Haves)

* prevent publishing if AI config would leave tenant with broken navigation
* prevent “empty allowlist” errors from breaking tool features
* enforce required defaults
* provide test-run button for workflows and prompts

---

## 9. Test & Sandbox Mode

Studio should support:

* test prompt execution (sandbox)
* workflow dry-run preview
* tool dry-run

Sandbox must:

* not write data
* use test connectors

---

## 10. Access Control in Studio

Studio modules must be permissioned:

* tenant admin: tenant configs
* platform admin: global policies and provider catalog
* coach: view only or propose changes

---

## 11. Phase 1 Minimum Implementation

1. AI feature catalog + prompt editor
2. routing rules UI
3. tool allowlists UI + OAuth connect
4. workflow builder (basic)
5. validate/publish/rollback with audit logs

---

## 12. Non-Negotiables Summary

* Studio is the control plane
* publish is gated by validation
* rollback is instant
* child safety cannot be weakened
* all changes are auditable

---

This guide ensures Platform Studio can govern AI and automation safely and at scale across tenants.
